# AI Advent 25 - Туристический агент на базе YandexGPT

## Описание

Приложение представляет собой туристического агента, использующего YandexGPT для подбора городов для путешествий по России. Агент работает по строго определенному алгоритму: задает ровно 4 вопроса по одному и на основе ответов генерирует персонализированные рекомендации.

## Архитектура

### Системный промпт LLM

Приложение использует максимально строгий и однозначный системный промпт, который исключает любые ошибки LLM:

**Основные правила:**
1. Задавать ТОЛЬКО ОДИН вопрос за раз
2. После ответа пользователя задавать следующий вопрос
3. Всего ровно 4 вопроса
4. После 4-го ответа сразу давать рекомендации
5. НИКОГДА не отвечать за пользователя
6. НИКОГДА не задавать несколько вопросов сразу
7. ВСЕГДА отвечать в JSON формате

**Порядок вопросов:**
- Вопрос 1: "Сколько человек планирует путешествие?"
- Вопрос 2: "Какой бюджет планируете на поездку?"
- Вопрос 3: "Какое время года предпочитаете?"
- Вопрос 4: "Какие достопримечательности вас интересуют больше всего?"

### Улучшенный парсер JSON

Приложение использует улучшенный парсер, который:
- Точно находит JSON объекты в ответе LLM
- Обрабатывает случаи с несколькими JSON объектами
- Корректно парсит вопросы и рекомендации
- Дополнительно проверяет обычные ответы на наличие JSON

### Форматы ответов

LLM возвращает ответы в двух строго определенных JSON форматах:

#### 1. Вопрос (для первых 4 взаимодействий)
```json
{
  "type": "question",
  "questionNumber": 1,
  "nextQuestion": "Сколько человек планирует путешествие?",
  "collectedInfo": [],
  "remainingQuestions": 3
}
```

#### 2. Рекомендации (после 4-го ответа)
```json
{
  "type": "recommendations",
  "summary": "Резюме путешествия",
  "recommendations": [
    {
      "city": "Название города",
      "description": "Описание города",
      "attractions": ["Достопримечательность 1", "Достопримечательность 2"],
      "costs": "1000",
      "bestTime": "Лето"
    }
  ],
  "totalBudget": "3000"
}
```

### Модели данных

- **AgentResponse.Question**: Модель для вопросов от агента
- **AgentResponse.Recommendations**: Модель для рекомендаций
- **QuestionData**: UI модель для отображения данных о вопросе
- **TravelRecommendation**: UI модель для отображения рекомендаций
- **CityRecommendation**: Модель для рекомендаций по конкретному городу

### Компоненты

- **JsonResponseParser**: Парсит ответы LLM согласно системному промпту
- **ChatViewModel**: Управляет состоянием чата и обрабатывает ответы
- **ChatScreen**: UI для отображения чата с агентом
- **QuestionDataCard**: Компонент для отображения информации о вопросе
- **TravelRecommendationCard**: Компонент для отображения рекомендаций

## Особенности

1. **Предсказуемость**: LLM работает по строго определенному алгоритму без отклонений
2. **Структурированные ответы**: Все ответы парсятся в строго определенные JSON форматы
3. **Прогресс-бар**: Показывает прогресс сбора информации (вопросы 1-4)
4. **Сбор информации**: Агент собирает информацию пошагово, задавая по одному вопросу
5. **Автоматический переход**: После 4-го ответа автоматически генерируются рекомендации

## Технический стек

- **Kotlin** + **Jetpack Compose**
- **Retrofit** + **OkHttp** для API
- **Gson** для парсинга JSON
- **YandexGPT API** для LLM
- **MVVM архитектура** с **StateFlow**

## Настройка

1. Получите API ключ YandexGPT
2. Введите API ключ в приложении
3. Начните диалог с агентом, введя "В путь!"

## Логика работы

1. **Инициализация**: Агент приветствует пользователя
2. **Сбор информации**: Агент задает 4 вопроса по одному
3. **Обработка ответов**: Каждый ответ сохраняется в collectedInfo
4. **Генерация рекомендаций**: После 4-го ответа автоматически генерируются рекомендации
5. **Отображение**: Рекомендации отображаются в структурированном виде

## Ключевые принципы

- **Простота**: Минимальный и понятный промпт для LLM
- **Строгость**: Четкие правила без возможности интерпретации
- **Предсказуемость**: LLM всегда следует одному и тому же алгоритму
- **Надежность**: Отсутствие сложной логики обработки ошибок
